# **ì œí’ˆ ìš”êµ¬ì‚¬í•­ ëª…ì„¸ì„œ (PRD): ìš©ì¸ ê·¸ë¦°ì›Œì¹˜ (Yongin GreenWatch)**

**ë²„ì „:** 1.0  
**ì‘ì„±ì¼:** 2025ë…„ 10ì›” 3ì¼  
**ì‘ì„±ì:** ë°•ìš©í™˜  
**ìƒíƒœ:** ì´ˆì•ˆ

---

## **1. ê°œìš” (Overview)**

### **1.1. ë¬¸ì œ ì •ì˜ (Problem Statement)**

ìš©ì¸ì‹œëŠ” ì¸êµ¬ 110ë§Œ ëª…ì˜ ê²½ê¸°ë„ ì œ2ë„ì‹œì´ì, ì‚¼ì„±ì „ìÂ·SKí•˜ì´ë‹‰ìŠ¤ ë°˜ë„ì²´ í´ëŸ¬ìŠ¤í„°ê°€ ìœ„ì¹˜í•œ ì²¨ë‹¨ì‚°ì—… ë„ì‹œì´ë‹¤. ê·¸ëŸ¬ë‚˜ ê¸‰ê²©í•œ ì‚°ì—…í™”ì™€ ë„ì‹œí™”ë¡œ ì¸í•´ ì‹œë¯¼ë“¤ì€ ë‹¤ìŒê³¼ ê°™ì€ í™˜ê²½ ë¬¸ì œì— ì§ë©´í•´ ìˆë‹¤:

**1) ì •ë³´ ì ‘ê·¼ì„± ë¬¸ì œ**
- ëŒ€ê¸°ì§ˆ, ìˆ˜ì§ˆ ë“± í™˜ê²½ ë°ì´í„°ê°€ ì—ì–´ì½”ë¦¬ì•„, ë¬¼í™˜ê²½ì •ë³´ì‹œìŠ¤í…œ ë“± ì—¬ëŸ¬ í”Œë«í¼ì— ë¶„ì‚°ë˜ì–´ ìˆì–´ í†µí•© í™•ì¸ ë¶ˆê°€
- ë°˜ë„ì²´ í´ëŸ¬ìŠ¤í„°, ì‚°ì—…ë‹¨ì§€ ì¸ê·¼ ì£¼ë¯¼ë“¤ì€ í™˜ê²½ ìœ„í—˜ì— ë…¸ì¶œë˜ì§€ë§Œ ì‹¤ì‹œê°„ ì •ë³´ ë¶€ì¡±ìœ¼ë¡œ ë¶ˆì•ˆê° ê°€ì¤‘
- ì²˜ì¸êµ¬, ê¸°í¥êµ¬, ìˆ˜ì§€êµ¬ ê°„ í™˜ê²½ ì¸¡ì • ì¸í”„ë¼ ê²©ì°¨ë¡œ ì¸í•œ ì •ë³´ ë¶ˆí‰ë“±

**2) ì‹œë¯¼ ì°¸ì—¬ ì¥ë²½**
- ì•…ì·¨, ì†ŒìŒ, íìˆ˜ ë“± ì¼ìƒì  í™˜ê²½ ë¶ˆí¸ì„ ì œë³´í•  ê°„í¸í•œ ê³µì‹ ì°½êµ¬ ë¶€ì¬
- 120ë‹¤ì‚°ì½œì„¼í„°, ë¯¼ì›24 ë“± ê¸°ì¡´ ë¯¼ì› ì‹œìŠ¤í…œì€ ë³µì¡í•˜ê³  í”¼ë“œë°± ì§€ì—°
- ì œë³´ í›„ ì²˜ë¦¬ ê³¼ì • ë° ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ì–´ 'ì œë³´í•´ë„ ì†Œìš©ì—†ë‹¤'ëŠ” ë¬´ë ¥ê° í™•ì‚°

**3) ì •ì±… ì˜ì‚¬ê²°ì •ì˜ í•œê³„**
- ì‹œë¯¼ë“¤ì˜ í˜„ì¥ ëª©ì†Œë¦¬ê°€ ì •ì±…ì— ë°˜ì˜ë˜ëŠ” ì²´ê³„ ë¯¸í¡
- í™˜ê²½ ë¯¼ì›ì´ ì‚°ë°œì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì–´ íŒ¨í„´ ë¶„ì„ ë° ìš°ì„ ìˆœìœ„ ê²°ì • ì–´ë ¤ì›€
- ë°ì´í„° ê¸°ë°˜ ì •ì±… ìˆ˜ë¦½ë³´ë‹¤ëŠ” ë¯¼ì› ëŒ€ì‘ì‹ í–‰ì •ì— ê·¸ì¹¨

### **1.2. ì œí’ˆ ë¹„ì „ (Vision)**

**"ë°ì´í„°ë¡œ ìˆ¨ ì‰¬ëŠ” ìš©ì¸, ì‹œë¯¼ì˜ ì†ìœ¼ë¡œ ë§Œë“œëŠ” íˆ¬ëª…í•œ í™˜ê²½ë„ì‹œ"**

ìš©ì¸ ê·¸ë¦°ì›Œì¹˜ëŠ” ë°˜ë„ì²´ í´ëŸ¬ìŠ¤í„°ì™€ ì¹œí™˜ê²½ ë„ì‹œê°€ ê³µì¡´í•˜ëŠ” ì§€ì†ê°€ëŠ¥í•œ ìš©ì¸ì„ ë§Œë“¤ê¸° ìœ„í•œ ì‹œë¯¼ ì°¸ì—¬í˜• í™˜ê²½ ê±°ë²„ë„ŒìŠ¤ í”Œë«í¼ì´ë‹¤. ìš°ë¦¬ëŠ”:

1. **íˆ¬ëª…ì„±**: ëª¨ë“  ì‹œë¯¼ì—ê²Œ ì‹¤ì‹œê°„ í™˜ê²½ ë°ì´í„°ë¥¼ ì œê³µí•˜ì—¬ ì•Œ ê¶Œë¦¬ë¥¼ ë³´ì¥í•œë‹¤
2. **ì°¸ì—¬**: ëˆ„êµ¬ë‚˜ ì‰½ê²Œ í™˜ê²½ ë¬¸ì œë¥¼ ì œë³´í•˜ê³  ê³µê°í•˜ë©° ë³€í™”ë¥¼ ë§Œë“œëŠ” ì£¼ì²´ê°€ ë˜ë„ë¡ í•œë‹¤
3. **ì‹ ë¢°**: ì œë³´ë¶€í„° ì²˜ë¦¬ê¹Œì§€ íˆ¬ëª…í•œ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹œë¯¼-í–‰ì • ê°„ ì‹ ë¢°ë¥¼ êµ¬ì¶•í•œë‹¤
4. **ì§€ì†ê°€ëŠ¥ì„±**: í™˜ê²½ ê°œì„  í™œë™ì— ë³´ìƒì„ ì œê³µí•˜ì—¬ ì¹œí™˜ê²½ ìƒíƒœê³„ë¥¼ ë§Œë“ ë‹¤

### **1.3. ëª©í‘œ ì‚¬ìš©ì (Target Audience)**

**í•µì‹¬ ì‚¬ìš©ì (Primary Users)**

| í˜ë¥´ì†Œë‚˜ | íŠ¹ì„± | ë‹ˆì¦ˆ | ì•± ì‚¬ìš© ëª©ì  |
|---------|------|------|-------------|
| **í™˜ê²½ ë¯¼ê° ì‹œë¯¼** (ê¹€ë¯¸ì •, 37ì„¸, ì£¼ë¶€) | - ì´ˆë“±í•™ìƒ ìë…€ 2ëª…<br>- ê¸°í¥êµ¬ ë°˜ë„ì²´ë‹¨ì§€ ì¸ê·¼ ê±°ì£¼<br>- ì•„ì´ ì²œì‹ìœ¼ë¡œ ëŒ€ê¸°ì§ˆ ë¯¼ê° | - ìš°ë¦¬ ë™ë„¤ ì‹¤ì‹œê°„ ëŒ€ê¸°ì§ˆ í™•ì¸<br>- ë¯¸ì„¸ë¨¼ì§€ ë‚˜ì¨ ì‹œ ì•Œë¦¼ ë°›ê¸°<br>- í•™êµ ì£¼ë³€ í™˜ê²½ ëª¨ë‹ˆí„°ë§ | ë§¤ì¼ ëŒ€ê¸°ì§ˆ í™•ì¸, í•„ìš”ì‹œ ì œë³´ |
| **ì²­ë…„ í™˜ê²½ìš´ë™ê°€** (ì´ì¤€í˜¸, 28ì„¸, NGO í™œë™ê°€) | - ìš©ì¸í™˜ê²½ìš´ë™ì—°í•© ê°„ì‚¬<br>- ì²˜ì¸êµ¬ ê±°ì£¼<br>- í™˜ê²½ ì •ì±… ëª¨ë‹ˆí„°ë§ í™œë™ | - ì§€ì—­ë³„ í™˜ê²½ ë°ì´í„° ìˆ˜ì§‘<br>- íŒ¨í„´ ë¶„ì„ì„ í†µí•œ ì •ì±… ì œì•ˆ<br>- ì‹œë¯¼ ì œë³´ ë°ì´í„° í™œìš© | ì£¼ 3íšŒ ì´ìƒ, ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ |
| **ì‚°ì—…ë‹¨ì§€ ì¸ê·¼ ì£¼ë¯¼** (ë°•ì² ìˆ˜, 52ì„¸, ìì˜ì—…) | - ì²˜ì¸êµ¬ ì‚°ì—…ë‹¨ì§€ ì¸ê·¼ ê±°ì£¼<br>- ì•¼ê°„ ì•…ì·¨ ë¶ˆí¸ ê²½í—˜<br>- IT í™œìš© ëŠ¥ë ¥ ë³´í†µ | - ì•…ì·¨ ë°œìƒ ì‹œ ì¦‰ì‹œ ì œë³´<br>- ê°™ì€ ë¬¸ì œ ê²ªëŠ” ì´ì›ƒ í™•ì¸<br>- ë¯¼ì› ì²˜ë¦¬ ê²°ê³¼ í™•ì¸ | ë¬¸ì œ ë°œìƒ ì‹œ ì¦‰ì‹œ ì œë³´ |

**í™•ì¥ ì‚¬ìš©ì (Secondary Users)**

| í˜ë¥´ì†Œë‚˜ | íŠ¹ì„± | ë‹ˆì¦ˆ | ì•± ì‚¬ìš© ëª©ì  |
|---------|------|------|-------------|
| **ì¹œí™˜ê²½ ì†Œìƒê³µì¸** (ìµœì€ì˜, 45ì„¸, ì œë¡œì›¨ì´ìŠ¤íŠ¸ìƒµ ìš´ì˜) | - ìˆ˜ì§€êµ¬ ì œë¡œì›¨ì´ìŠ¤íŠ¸ìƒµ ìš´ì˜<br>- í™˜ê²½ ê°€ì¹˜ ì¤‘ì‹œ<br>- ê³ ê° í™•ë³´ ê³ ë¯¼ | - í™˜ê²½ ì˜ì‹ ë†’ì€ ê³ ê° ìœ ì¹˜<br>- ìƒì  í™ë³´ ì±„ë„ í™•ë³´<br>- ì§€ì—­ì‚¬íšŒ ê¸°ì—¬ | ì›” 1íšŒ í˜œíƒ ë“±ë¡, ì´ë²¤íŠ¸ |
| **í™˜ê²½ì •ì±… ê³µë¬´ì›** (ì •ë¯¼ìˆ˜, 39ì„¸, í™˜ê²½ì •ì±…ê³¼ ì£¼ë¬´ê´€) | - ìš©ì¸ì‹œì²­ í™˜ê²½ì •ì±…ê³¼<br>- ëŒ€ê¸°ì§ˆ ê°œì„  ì •ì±… ë‹´ë‹¹<br>- ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì • ì„ í˜¸ | - ì‹œë¯¼ ì œë³´ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§<br>- ì§€ì—­ë³„ í™˜ê²½ ë¬¸ì œ íŒ¨í„´ íŒŒì•…<br>- ì •ì±… íš¨ê³¼ ì¸¡ì • | ë§¤ì¼ ëŒ€ì‹œë³´ë“œ í™•ì¸ |

### **1.4. ì„±ê³µ ì§€í‘œ (Success Metrics / KPIs)**

**1ë‹¨ê³„ (MVP, 6ê°œì›” í›„)**
- ì•± ë‹¤ìš´ë¡œë“œ: 5,000ê±´
- ì›”ê°„ í™œì„± ì‚¬ìš©ì(MAU): 2,000ëª…
- ëˆ„ì  ì œë³´ ê±´ìˆ˜: 500ê±´
- ì œë³´ í‰ê·  ì²˜ë¦¬ ì‹œê°„: 5ì¼ ì´ë‚´

**2ë‹¨ê³„ (V1.0, 12ê°œì›” í›„)**
- MAU: 10,000ëª…
- ì›” í‰ê·  ì œë³´: 300ê±´
- ì œë³´ ê³µê°: 3,000ê±´/ì›”
- ì‹œë¯¼ ë§Œì¡±ë„: 70ì  ì´ìƒ(100ì  ë§Œì )

**3ë‹¨ê³„ (V1.5, 24ê°œì›” í›„)**
- MAU: 50,000ëª… (ì‹œë¯¼ì˜ 5%)
- íŒŒíŠ¸ë„ˆ ìƒì : 50ê°œ
- ì›”ê°„ í¬ì¸íŠ¸ ì‚¬ìš©ë¥ : 25%
- ì •ì±… ë°˜ì˜ ì‚¬ë¡€: ì—° 10ê±´

**ë¹„ì¦ˆë‹ˆìŠ¤ ì„íŒ©íŠ¸**
- í™˜ê²½ ë¯¼ì› ì²˜ë¦¬ íš¨ìœ¨ 30% í–¥ìƒ
- ì‹œë¯¼ í™˜ê²½ ë§Œì¡±ë„ 15ì  ìƒìŠ¹
- ì¹œí™˜ê²½ ì†Œë¹„ 10ì–µ ì› ìœ ë°œ íš¨ê³¼

---

## **2. ì œí’ˆ ê¸°ëŠ¥ ëª…ì„¸ (Features & Requirements)**

### **Epic 1: ì‹¤ì‹œê°„ í™˜ê²½ ì§€ë„ (Real-time Environment Map)**

**Epic Goal**: ì‹œë¯¼ë“¤ì´ ìš©ì¸ì‹œ ì „ì—­ì˜ í™˜ê²½ ë°ì´í„°ë¥¼ ì§ê´€ì ì¸ ì§€ë„ë¡œ í•œëˆˆì— íŒŒì•…í•  ìˆ˜ ìˆë‹¤.

#### **User Story 1.1: ì§€ë„ ê¸°ë°˜ ëŒ€ê¸°ì§ˆ í™•ì¸**

**As a** í™˜ê²½ ë¯¼ê° ì‹œë¯¼  
**I want to** ìš°ë¦¬ ë™ë„¤ì˜ ì‹¤ì‹œê°„ ë¯¸ì„¸ë¨¼ì§€ ë†ë„ë¥¼ ì§€ë„ì—ì„œ í™•ì¸í•˜ê³   
**So that** ì™¸ì¶œ ì—¬ë¶€ë¥¼ ê²°ì •í•˜ê³  ìë…€ ê±´ê°•ì„ ì§€í‚¬ ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ìš©ì¸ì‹œ ì „ì²´ ì§€ë„ì— ëŒ€ê¸°ì§ˆ ì¸¡ì •ì†Œê°€ í‘œì‹œëœë‹¤
- [ ] ê° ì¸¡ì •ì†ŒëŠ” ì˜¤ì—¼ë„ì— ë”°ë¼ ìƒ‰ìƒì´ ë‹¤ë¥´ë‹¤ (ì¢‹ìŒ-íŒŒë‘, ë³´í†µ-ì´ˆë¡, ë‚˜ì¨-ì£¼í™©, ë§¤ìš°ë‚˜ì¨-ë¹¨ê°•)
- [ ] ì¸¡ì •ì†Œ ë§ˆì»¤ í´ë¦­ ì‹œ ìƒì„¸ ì •ë³´(PM10, PM2.5, O3, NO2, SO2, CO)ê°€ í‘œì‹œëœë‹¤
- [ ] ë°ì´í„°ëŠ” 5ë¶„ë§ˆë‹¤ ìë™ ê°±ì‹ ëœë‹¤
- [ ] í˜„ì¬ ìœ„ì¹˜ ê¸°ì¤€ ê°€ì¥ ê°€ê¹Œìš´ ì¸¡ì •ì†Œê°€ ê°•ì¡° í‘œì‹œëœë‹¤

**ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (FR):**

**FR 1.1.1: ì¹´ì¹´ì˜¤ë§µ í†µí•©**
- ì¹´ì¹´ì˜¤ë§µ Web SDK v2ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§€ë„ ë Œë”ë§
- ì§€ë„ ë ˆë²¨: 3~14 (ì‹œ ì „ì²´ ~ ë™ë„¤ ë‹¨ìœ„)
- ê¸°ë³¸ ì¤‘ì‹¬ì¢Œí‘œ: ìš©ì¸ì‹œì²­(37.2411, 127.1776)
- í˜„ì¬ ìœ„ì¹˜ ì¶”ì  ë²„íŠ¼ ì œê³µ

**FR 1.1.2: ì—ì–´ì½”ë¦¬ì•„ API ì—°ë™**
```typescript
// API ì—”ë“œí¬ì¸íŠ¸
const AIR_KOREA_API = 'http://apis.data.go.kr/B552584/ArpltnInforInqireSvc'

// ìš©ì¸ì‹œ ì¸¡ì •ì†Œ ëª©ë¡ (ì‹¤ì œ ì¸¡ì •ì†Œëª… í™•ì¸ í•„ìš”)
const YONGIN_STATIONS = [
  { name: 'ìˆ˜ì§€', lat: 37.3242, lng: 127.0973, stationName: 'ìˆ˜ì§€' },
  { name: 'ê¸°í¥', lat: 37.2757, lng: 127.1175, stationName: 'ê¸°í¥' },
  // ... ê¸°íƒ€ ì¸¡ì •ì†Œ
]

// ì‹¤ì‹œê°„ ë°ì´í„° ì¡°íšŒ (5ë¶„ë§ˆë‹¤ ìë™ ê°±ì‹ )
interface AirQualityData {
  stationName: string
  dataTime: string
  pm10Value: number
  pm25Value: number
  o3Value: number
  no2Value: number
  so2Value: number
  coValue: number
  pm10Grade: 1 | 2 | 3 | 4  // 1:ì¢‹ìŒ, 2:ë³´í†µ, 3:ë‚˜ì¨, 4:ë§¤ìš°ë‚˜ì¨
  pm25Grade: 1 | 2 | 3 | 4
}
```

**FR 1.1.3: ë§ˆì»¤ ì‹œê°í™”**
- SVG ì»¤ìŠ¤í…€ ë§ˆì»¤ ì‚¬ìš© (ìƒ‰ìƒ ë™ì  ë³€ê²½)
- ë§ˆì»¤ í¬ê¸°: 40x40px
- í˜¸ë²„ ì‹œ íˆ´íŒìœ¼ë¡œ PM2.5 ìˆ˜ì¹˜ í‘œì‹œ
- í´ë¦­ ì‹œ ìƒì„¸ ëª¨ë‹¬ ì˜¤í”ˆ

**FR 1.1.4: ì„±ëŠ¥ ìµœì í™”**
- React Queryë¡œ API ìºì‹± (5ë¶„ TTL)
- ì§€ë„ ì´ë™ ì‹œ ë””ë°”ìš´ì‹± (500ms)
- ê°€ì‹œ ì˜ì—­ ë‚´ ë§ˆì»¤ë§Œ ë Œë”ë§

---

#### **User Story 1.2: ì˜¤ì—¼ë¬¼ì§ˆë³„ íˆíŠ¸ë§µ**

**As a** í™˜ê²½ í™œë™ê°€  
**I want to** íŠ¹ì • ì˜¤ì—¼ë¬¼ì§ˆ(ì˜ˆ: ë¯¸ì„¸ë¨¼ì§€)ì˜ ì§€ì—­ë³„ ë†ë„ ë¶„í¬ë¥¼ íˆíŠ¸ë§µìœ¼ë¡œ ë³´ê³   
**So that** ì˜¤ì—¼ ì§‘ì¤‘ ì§€ì—­ì„ íŒŒì•…í•˜ê³  ì •ì±… ì œì•ˆ ìë£Œë¡œ í™œìš©í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ì˜¤ì—¼ë¬¼ì§ˆ ì„ íƒ ë“œë¡­ë‹¤ìš´(PM10, PM2.5, O3, NO2)ì´ ì œê³µëœë‹¤
- [ ] ì„ íƒí•œ ì˜¤ì—¼ë¬¼ì§ˆì˜ íˆíŠ¸ë§µì´ ì§€ë„ì— ì˜¤ë²„ë ˆì´ëœë‹¤
- [ ] íˆíŠ¸ë§µì€ ì¸¡ì •ì†Œ ë°ì´í„°ë¥¼ ë³´ê°„í•˜ì—¬ ë¶€ë“œëŸ¬ìš´ ê·¸ë˜ë””ì–¸íŠ¸ë¡œ í‘œì‹œëœë‹¤
- [ ] ë²”ë¡€ê°€ í‘œì‹œë˜ì–´ ìƒ‰ìƒë³„ ë†ë„ ë²”ìœ„ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤

**ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (FR):**

**FR 1.2.1: íˆíŠ¸ë§µ ë Œë”ë§**
```typescript
// Leaflet Heatmap.js ë˜ëŠ” ì¹´ì¹´ì˜¤ë§µ ì˜¤ë²„ë ˆì´ í™œìš©
interface HeatmapPoint {
  lat: number
  lng: number
  value: number  // ì˜¤ì—¼ë¬¼ì§ˆ ë†ë„
}

// IDW (Inverse Distance Weighting) ë³´ê°„ë²• ì ìš©
function interpolateAirQuality(
  stations: StationData[],
  gridResolution: number = 100
): HeatmapPoint[] {
  // ê²©ì ìƒì„± ë° ë³´ê°„ ë¡œì§
}
```

**FR 1.2.2: ë²”ë¡€ UI**
- ê·¸ë˜ë””ì–¸íŠ¸ ë°” (íŒŒë‘ â†’ ì´ˆë¡ â†’ ì£¼í™© â†’ ë¹¨ê°•)
- ê° ìƒ‰ìƒ êµ¬ê°„ì˜ ë†ë„ ìˆ˜ì¹˜ í‘œì‹œ
- ìµœì†Œ/ìµœëŒ€ê°’ ë™ì  ì¡°ì •

---

#### **User Story 1.3: ì‹œê°„ëŒ€ë³„ ë°ì´í„° ì¡°íšŒ**

**As a** ì¼ë°˜ ì‹œë¯¼  
**I want to** ì˜¤ëŠ˜, ì–´ì œ, ì§€ë‚œì£¼ì˜ ëŒ€ê¸°ì§ˆ ë³€í™” ì¶”ì´ë¥¼ í™•ì¸í•˜ê³   
**So that** ëŒ€ê¸°ì§ˆ ê°œì„  ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ê³  íŒ¨í„´ì„ íŒŒì•…í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ì‹œê°„ í•„í„°(ì‹¤ì‹œê°„, ì˜¤ëŠ˜, ì–´ì œ, ì§€ë‚œ 7ì¼, ì§€ë‚œ 30ì¼) ì œê³µ
- [ ] ì„ íƒí•œ ê¸°ê°„ì˜ í‰ê· ê°’ì´ ì§€ë„ì— í‘œì‹œëœë‹¤
- [ ] ì¸¡ì •ì†Œ í´ë¦­ ì‹œ í•´ë‹¹ ê¸°ê°„ì˜ ë¼ì¸ ì°¨íŠ¸ê°€ í‘œì‹œëœë‹¤

**ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (FR):**

**FR 1.3.1: ì‹œê³„ì—´ ë°ì´í„° ì €ì¥**
```sql
-- Supabase PostgreSQL ìŠ¤í‚¤ë§ˆ
CREATE TABLE air_quality_history (
  id BIGSERIAL PRIMARY KEY,
  station_name VARCHAR(50) NOT NULL,
  measured_at TIMESTAMPTZ NOT NULL,
  pm10_value DECIMAL(5,1),
  pm25_value DECIMAL(5,1),
  o3_value DECIMAL(5,3),
  no2_value DECIMAL(5,3),
  so2_value DECIMAL(5,3),
  co_value DECIMAL(5,1),
  pm10_grade INTEGER,
  pm25_grade INTEGER,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_station_measured ON air_quality_history(station_name, measured_at DESC);
```

**FR 1.3.2: ì‹œê³„ì—´ ì°¨íŠ¸**
- Recharts ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
- Xì¶•: ì‹œê°„, Yì¶•: ì˜¤ì—¼ë¬¼ì§ˆ ë†ë„
- ë‹¤ì¤‘ ì˜¤ì—¼ë¬¼ì§ˆ ë™ì‹œ í‘œì‹œ (í† ê¸€ ê°€ëŠ¥)
- ê¸°ì¤€ì„ (ì¢‹ìŒ/ë³´í†µ/ë‚˜ì¨ ê²½ê³„) í‘œì‹œ

---

#### **User Story 1.4: ì£¼ìš” ì‹œì„¤ ì •ë³´ í‘œì‹œ**

**As a** ì‚°ì—…ë‹¨ì§€ ì¸ê·¼ ì£¼ë¯¼  
**I want to** ë°˜ë„ì²´ ê³µì¥, íê¸°ë¬¼ ì²˜ë¦¬ì‹œì„¤ ë“± ì£¼ìš” ì˜¤ì—¼ì›ì˜ ìœ„ì¹˜ë¥¼ ì§€ë„ì—ì„œ í™•ì¸í•˜ê³   
**So that** í•´ë‹¹ ì‹œì„¤ê³¼ ìš°ë¦¬ ì§‘ì˜ ê±°ë¦¬, ì˜í–¥ ì •ë„ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ë°˜ë„ì²´ í´ëŸ¬ìŠ¤í„°, ì‚°ì—…ë‹¨ì§€, í•˜ìˆ˜ì²˜ë¦¬ì¥ ìœ„ì¹˜ê°€ ì•„ì´ì½˜ìœ¼ë¡œ í‘œì‹œëœë‹¤
- [ ] ê° ì‹œì„¤ì€ ì¼ë°˜ ì¸¡ì •ì†Œì™€ êµ¬ë³„ë˜ëŠ” ë””ìì¸ì´ë‹¤
- [ ] ì‹œì„¤ í´ë¦­ ì‹œ ëª…ì¹­, ì£¼ì†Œ, ìš´ì˜ ì •ë³´ê°€ í‘œì‹œëœë‹¤
- [ ] ë ˆì´ì–´ í† ê¸€ë¡œ ì‹œì„¤ í‘œì‹œ/ìˆ¨ê¹€ ê°€ëŠ¥

**ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (FR):**

**FR 1.4.1: ì‹œì„¤ ë°ì´í„°ë² ì´ìŠ¤**
```typescript
interface FacilityInfo {
  id: string
  name: string
  type: 'semiconductor' | 'industrial' | 'wastewater' | 'waste'
  lat: number
  lng: number
  address: string
  operator?: string
  info_url?: string
}

// ì‹œì„¤ ëª©ë¡ (ì´ˆê¸° ë°ì´í„°)
const MAJOR_FACILITIES: FacilityInfo[] = [
  {
    id: 'samsung_giheung',
    name: 'ì‚¼ì„±ì „ì ê¸°í¥ìº í¼ìŠ¤',
    type: 'semiconductor',
    lat: 37.2745,
    lng: 127.0696,
    address: 'ê²½ê¸°ë„ ìš©ì¸ì‹œ ê¸°í¥êµ¬ ì‚¼ì„±ë¡œ 1'
  },
  // ... ê¸°íƒ€ ì‹œì„¤
]
```

**FR 1.4.2: ì»¤ìŠ¤í…€ ë§ˆì»¤ ë””ìì¸**
- ë°˜ë„ì²´: ì¹© ì•„ì´ì½˜ (íŒŒë€ìƒ‰)
- ì‚°ì—…ë‹¨ì§€: ê³µì¥ ì•„ì´ì½˜ (íšŒìƒ‰)
- í•˜ìˆ˜ì²˜ë¦¬ì¥: ë¬¼ë°©ìš¸ ì•„ì´ì½˜ (ì²­ë¡ìƒ‰)
- íê¸°ë¬¼: ì“°ë ˆê¸°í†µ ì•„ì´ì½˜ (ì£¼í™©ìƒ‰)

---

### **Epic 2: ì‹œë¯¼ ì œë³´ ì‹œìŠ¤í…œ (Citizen Reporting System)**

**Epic Goal**: ì‹œë¯¼ë“¤ì´ í™˜ê²½ ë¬¸ì œë¥¼ ë°œê²¬í–ˆì„ ë•Œ 30ì´ˆ ì•ˆì— ì‰½ê²Œ ì œë³´í•˜ê³ , ë‹¤ë¥¸ ì‹œë¯¼ë“¤ê³¼ ê³µìœ í•  ìˆ˜ ìˆë‹¤.

#### **User Story 2.1: ì›í„°ì¹˜ ì œë³´**

**As a** ì‚°ì—…ë‹¨ì§€ ì¸ê·¼ ì£¼ë¯¼  
**I want to** ê³µì¥ ì•…ì·¨ë¥¼ ë°œê²¬í–ˆì„ ë•Œ ì¦‰ì‹œ ì‚¬ì§„ì„ ì°ì–´ ì œë³´í•˜ê³   
**So that** ë‹´ë‹¹ ë¶€ì„œê°€ ë¹ ë¥´ê²Œ ëŒ€ì‘í•˜ê³  ê°™ì€ ë¬¸ì œë¥¼ ê²ªëŠ” ì´ì›ƒë“¤ê³¼ ì—°ëŒ€í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ë©”ì¸ í™”ë©´ì— 'ì œë³´í•˜ê¸°' í”Œë¡œíŒ… ë²„íŠ¼ì´ í•­ìƒ í‘œì‹œëœë‹¤
- [ ] ë²„íŠ¼ í´ë¦­ ì‹œ ì¹´ë©”ë¼ê°€ ìë™ ì‹¤í–‰ëœë‹¤
- [ ] ì‚¬ì§„ ì´¬ì˜ í›„ ìœ„ì¹˜ê°€ ìë™ íƒœê¹…ëœë‹¤
- [ ] ìœ í˜• ì„ íƒ â†’ ì„¤ëª… ì…ë ¥ â†’ ì œì¶œì´ 3ë‹¨ê³„ë¡œ ì™„ë£Œëœë‹¤
- [ ] ì œì¶œ í›„ "ì œë³´ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤" í™•ì¸ ë©”ì‹œì§€ì™€ ì œë³´ ë²ˆí˜¸ê°€ í‘œì‹œëœë‹¤

**ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (FR):**

**FR 2.1.1: ì œë³´ UI/UX í”Œë¡œìš°**
```
[ë©”ì¸ í™”ë©´]
    â†“ (í”Œë¡œíŒ… ë²„íŠ¼ í´ë¦­)
[Step 1: ì‚¬ì§„ ì´¬ì˜]
  - ì¹´ë©”ë¼ ê¶Œí•œ ìš”ì²­
  - ì´¬ì˜ ë˜ëŠ” ê°¤ëŸ¬ë¦¬ ì„ íƒ
  - ìµœëŒ€ 5ì¥ê¹Œì§€ ì²¨ë¶€ ê°€ëŠ¥
    â†“
[Step 2: ìœ„ì¹˜ í™•ì¸]
  - GPS ìë™ íƒœê¹…
  - ì§€ë„ì—ì„œ í•€ ìœ„ì¹˜ ì¡°ì • ê°€ëŠ¥
  - ì£¼ì†Œ ìë™ í‘œì‹œ
    â†“
[Step 3: ì •ë³´ ì…ë ¥]
  - ìœ í˜• ì„ íƒ (ì•…ì·¨/íìˆ˜/íê¸°ë¬¼/ì†ŒìŒ/ëŒ€ê¸°ì˜¤ì—¼/ìˆ˜ì§ˆì˜¤ì—¼/ê¸°íƒ€)
  - ìƒì„¸ ì„¤ëª… (ì„ íƒ, ìµœëŒ€ 500ì)
  - ìµëª… ì œë³´ ì²´í¬ë°•ìŠ¤
    â†“
[ì œì¶œ í™•ì¸]
  - ì œë³´ ë²ˆí˜¸ í‘œì‹œ
  - "ë‚´ ì œë³´ ë³´ê¸°" ë²„íŠ¼
  - ê³µìœ í•˜ê¸° (SNS)
```

**FR 2.1.2: ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ**
```sql
CREATE TABLE reports (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),  -- null ê°€ëŠ¥ (ìµëª…)
  type VARCHAR(20) NOT NULL CHECK (type IN ('smell', 'wastewater', 'waste', 'noise', 'air', 'water', 'other')),
  description TEXT,
  lat DECIMAL(10, 7) NOT NULL,
  lng DECIMAL(10, 7) NOT NULL,
  address VARCHAR(200),
  status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'reviewing', 'resolved', 'rejected')),
  empathy_count INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE report_media (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  report_id UUID REFERENCES reports(id) ON DELETE CASCADE,
  media_url TEXT NOT NULL,
  media_type VARCHAR(10) CHECK (media_type IN ('image', 'video')),
  uploaded_at TIMESTAMPTZ DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_reports_status ON reports(status, created_at DESC);
CREATE INDEX idx_reports_location ON reports(lat, lng);
CREATE INDEX idx_reports_type ON reports(type);
```

**FR 2.1.3: ì´ë¯¸ì§€ ì—…ë¡œë“œ**
```typescript
// Supabase Storage í™œìš©
async function uploadReportMedia(
  file: File,
  reportId: string
): Promise<string> {
  const fileExt = file.name.split('.').pop()
  const fileName = `${reportId}/${Date.now()}.${fileExt}`
  const filePath = `reports/${fileName}`

  const { data, error } = await supabase.storage
    .from('report-media')
    .upload(filePath, file, {
      cacheControl: '3600',
      upsert: false
    })

  if (error) throw error

  // ê³µê°œ URL ë°˜í™˜
  const { data: { publicUrl } } = supabase.storage
    .from('report-media')
    .getPublicUrl(filePath)

  return publicUrl
}
```

**FR 2.1.4: GPS ì •í™•ë„ ì²˜ë¦¬**
- GPS ì •í™•ë„ 50m ì´ë‚´ì¼ ë•Œë§Œ ìë™ íƒœê¹…
- ì •í™•ë„ ë‚®ì„ ì‹œ "ìœ„ì¹˜ë¥¼ ì§€ë„ì—ì„œ ì§ì ‘ ì„ íƒí•´ì£¼ì„¸ìš”" ì•ˆë‚´
- ì£¼ì†Œ ë³€í™˜: ì¹´ì¹´ì˜¤ ë¡œì»¬ API ì‚¬ìš©

---

#### **User Story 2.2: ì œë³´ í”¼ë“œ ë° ê³µê°**

**As a** ì¼ë°˜ ì‹œë¯¼  
**I want to** ë‹¤ë¥¸ ì‚¬ëŒë“¤ì˜ ì œë³´ë¥¼ ì§€ë„ì™€ í”¼ë“œì—ì„œ í™•ì¸í•˜ê³  ê³µê° ë²„íŠ¼ì„ ëˆŒëŸ¬  
**So that** ê°™ì€ ë¬¸ì œë¥¼ ê²ªëŠ” ì´ì›ƒë“¤ê³¼ ì—°ëŒ€í•˜ê³  ë¬¸ì œì˜ ì‹¬ê°ì„±ì„ ì•Œë¦´ ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ì§€ë„ì— ì œë³´ê°€ ì˜¤ì—¼ ë§ˆì»¤ì™€ êµ¬ë³„ë˜ëŠ” ì•„ì´ì½˜ìœ¼ë¡œ í‘œì‹œëœë‹¤
- [ ] ì œë³´ ë§ˆì»¤ í´ë¦­ ì‹œ ì‚¬ì§„, ì„¤ëª…, ê³µê° ìˆ˜ê°€ í‘œì‹œëœë‹¤
- [ ] 'ê³µê°í•˜ê¸°' ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ ê³µê° ìˆ˜ê°€ ì¦ê°€í•œë‹¤
- [ ] í•˜ë‹¨ íƒ­ì—ì„œ 'ì œë³´ í”¼ë“œ'ë¡œ ì „í™˜ ì‹œ ìµœì‹  ì œë³´ ëª©ë¡ì´ í‘œì‹œëœë‹¤
- [ ] í”¼ë“œëŠ” 'ìµœì‹ ìˆœ', 'ê³µê°ìˆœ', 'ìš°ë¦¬ ë™ë„¤' ì •ë ¬ ì˜µì…˜ì´ ìˆë‹¤

**ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (FR):**

**FR 2.2.1: ì œë³´ ë§ˆì»¤ í‘œì‹œ**
```typescript
interface ReportMarker {
  id: string
  lat: number
  lng: number
  type: ReportType
  status: ReportStatus
  empathyCount: number
  createdAt: Date
}

// ë§ˆì»¤ ë””ìì¸
const REPORT_MARKER_ICONS = {
  smell: 'ğŸ¤¢',      // ì•…ì·¨
  wastewater: 'ğŸ’§', // íìˆ˜
  waste: 'ğŸ—‘ï¸',     // íê¸°ë¬¼
  noise: 'ğŸ”Š',      // ì†ŒìŒ
  air: 'ğŸ’¨',        // ëŒ€ê¸°ì˜¤ì—¼
  water: 'ğŸŒŠ',      // ìˆ˜ì§ˆì˜¤ì—¼
  other: 'âš ï¸'       // ê¸°íƒ€
}

// ìƒíƒœë³„ ë°°ê²½ìƒ‰
const STATUS_COLORS = {
  pending: '#FFA500',    // ì£¼í™© (ì²˜ë¦¬ ëŒ€ê¸°)
  reviewing: '#4169E1',  // íŒŒë‘ (ê²€í†  ì¤‘)
  resolved: '#32CD32',   // ì´ˆë¡ (í•´ê²° ì™„ë£Œ)
  rejected: '#DC143C'    // ë¹¨ê°• (ë°˜ë ¤)
}
```

**FR 2.2.2: ê³µê° ê¸°ëŠ¥**
```sql
CREATE TABLE report_empathy (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  report_id UUID REFERENCES reports(id) ON DELETE CASCADE,
  user_id UUID REFERENCES auth.users(id),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(report_id, user_id)  -- ì¤‘ë³µ ê³µê° ë°©ì§€
);

-- ê³µê° ìˆ˜ íŠ¸ë¦¬ê±°
CREATE OR REPLACE FUNCTION update_empathy_count()
RETURNS TRIGGER AS $$
BEGIN
  IF TG_OP = 'INSERT' THEN
    UPDATE reports SET empathy_count = empathy_count + 1 WHERE id = NEW.report_id;
  ELSIF TG_OP = 'DELETE' THEN
    UPDATE reports SET empathy_count = empathy_count - 1 WHERE id = OLD.report_id;
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER empathy_count_trigger
  AFTER INSERT OR DELETE ON report_empathy
  FOR EACH ROW EXECUTE FUNCTION update_empathy_count();
```

**FR 2.2.3: í”¼ë“œ UI**
```typescript
// í”¼ë“œ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
interface ReportFeedItem {
  id: string
  type: ReportType
  description: string
  images: string[]
  address: string
  empathyCount: number
  status: ReportStatus
  createdAt: Date
  hasEmpathized: boolean  // í˜„ì¬ ì‚¬ìš©ìì˜ ê³µê° ì—¬ë¶€
}

// ì •ë ¬ ì˜µì…˜
type SortOption = 'latest' | 'most_empathized' | 'nearby'

// í•„í„° ì˜µì…˜
interface FeedFilter {
  types?: ReportType[]
  status?: ReportStatus[]
  dateRange?: { start: Date; end: Date }
  radius?: number  // 'nearby' ì •ë ¬ ì‹œ ë°˜ê²½(km)
}
```

---

#### **User Story 2.3: ì œë³´ ìƒíƒœ ì¶”ì **

**As a** ì œë³´ì  
**I want to** ë‚´ê°€ ì œì¶œí•œ ì œë³´ì˜ ì²˜ë¦¬ í˜„í™©ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•˜ê³   
**So that** ë‹´ë‹¹ ë¶€ì„œê°€ ì–´ë–»ê²Œ ëŒ€ì‘í•˜ê³  ìˆëŠ”ì§€ ì•Œê³  ì‹ ë¢°í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] 'ë‚´ ì œë³´' íƒ­ì—ì„œ ì œë³´ ì´ë ¥ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤
- [ ] ê° ì œë³´ëŠ” ìƒíƒœ(ì ‘ìˆ˜â†’ê²€í† â†’í•´ê²°/ë°˜ë ¤)ê°€ í‘œì‹œëœë‹¤
- [ ] ìƒíƒœ ë³€ê²½ ì‹œ í‘¸ì‹œ ì•Œë¦¼ì„ ë°›ëŠ”ë‹¤
- [ ] í•´ê²° ì™„ë£Œ ì‹œ ë‹´ë‹¹ ë¶€ì„œì˜ ì¡°ì¹˜ ë‚´ìš©ì´ í‘œì‹œëœë‹¤

**ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (FR):**

**FR 2.3.1: ìƒíƒœ ê´€ë¦¬ ì‹œìŠ¤í…œ**
```sql
CREATE TABLE report_status_history (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  report_id UUID REFERENCES reports(id) ON DELETE CASCADE,
  status VARCHAR(20) NOT NULL,
  comment TEXT,
  department VARCHAR(50),  -- ë‹´ë‹¹ ë¶€ì„œ
  updated_by UUID,  -- ê³µë¬´ì› ID
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ë·°: ì œë³´ë³„ ìµœì‹  ìƒíƒœ
CREATE VIEW report_with_latest_status AS
SELECT 
  r.*,
  rsh.comment as latest_comment,
  rsh.department,
  rsh.updated_by,
  rsh.created_at as status_updated_at
FROM reports r
LEFT JOIN LATERAL (
  SELECT * FROM report_status_history
  WHERE report_id = r.id
  ORDER BY created_at DESC
  LIMIT 1
) rsh ON true;
```

**FR 2.3.2: í‘¸ì‹œ ì•Œë¦¼**
```typescript
// Firebase Cloud Messaging ë˜ëŠ” Supabase Realtime
async function notifyReportStatusChange(
  reportId: string,
  userId: string,
  newStatus: ReportStatus,
  comment: string
) {
  const notification = {
    title: 'ì œë³´ ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤',
    body: getStatusMessage(newStatus),
    data: {
      type: 'report_status',
      reportId,
      status: newStatus
    }
  }

  // í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡
  await sendPushNotification(userId, notification)

  // ì¸ì•± ì•Œë¦¼ ì €ì¥
  await supabase.from('notifications').insert({
    user_id: userId,
    type: 'report_status',
    title: notification.title,
    body: notification.body,
    data: notification.data
  })
}

function getStatusMessage(status: ReportStatus): string {
  const messages = {
    reviewing: 'ë‹´ë‹¹ ë¶€ì„œì—ì„œ ê²€í†  ì¤‘ì…ë‹ˆë‹¤',
    resolved: 'ì‹ ê³ í•˜ì‹  ë¬¸ì œê°€ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤',
    rejected: 'ì‹ ê³ ê°€ ë°˜ë ¤ë˜ì—ˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”'
  }
  return messages[status] || ''
}
```

---

### **Epic 3: AI ë¶„ì„ ë° ì¸ì‚¬ì´íŠ¸ (AI Analysis & Insights)**

**Epic Goal**: AIê°€ ì¶•ì ëœ ì œë³´ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ íŒ¨í„´ì„ ì°¾ê³ , ì‹œë¯¼ê³¼ ê³µë¬´ì›ì—ê²Œ ìœ ì˜ë¯¸í•œ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•œë‹¤.

#### **User Story 3.1: ìë™ íƒœê¹… ë° ë¶„ë¥˜**

**As a** í™˜ê²½ì •ì±… ê³µë¬´ì›  
**I want to** ì‹œë¯¼ ì œë³´ê°€ ë“¤ì–´ì™”ì„ ë•Œ AIê°€ ìë™ìœ¼ë¡œ í‚¤ì›Œë“œë¥¼ ì¶”ì¶œí•˜ê³  ì„¸ë¶€ ìœ í˜•ìœ¼ë¡œ ë¶„ë¥˜í•´ì„œ  
**So that** ë¯¼ì›ì„ ë¹ ë¥´ê²Œ íŒŒì•…í•˜ê³  ì ì ˆí•œ ë¶€ì„œë¡œ ë°°ì •í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ì œë³´ ì œì¶œ ì‹œ Claude AIê°€ í…ìŠ¤íŠ¸ì™€ ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•œë‹¤
- [ ] í•µì‹¬ í‚¤ì›Œë“œ(ì˜ˆ: 'í™”í•™ì•½í’ˆ ëƒ„ìƒˆ', 'ì•¼ê°„ ë°œìƒ')ê°€ ìë™ ì¶”ì¶œëœë‹¤
- [ ] ì„¸ë¶€ ìœ í˜•(ì˜ˆ: ì•…ì·¨ â†’ í™”í•™ë¬¼ì§ˆ ì•…ì·¨)ìœ¼ë¡œ ìë™ ë¶„ë¥˜ëœë‹¤
- [ ] ì´ë¯¸ì§€ì—ì„œ íìˆ˜, ì“°ë ˆê¸° ë“±ì„ ê°ì§€í•˜ê³  íƒœê·¸ë¥¼ ì¶”ê°€í•œë‹¤

**ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (FR):**

**FR 3.1.1: Claude API ì—°ë™**
```typescript
import Anthropic from '@anthropic-ai/sdk'

const anthropic = new Anthropic({
  apiKey: process.env.ANTHROPIC_API_KEY
})

async function analyzeReport(
  description: string,
  images: string[]
): Promise<ReportAnalysis> {
  const imageContents = await Promise.all(
    images.map(async (url) => {
      const base64 = await urlToBase64(url)
      return {
        type: 'image' as const,
        source: {
          type: 'base64' as const,
          media_type: 'image/jpeg' as const,
          data: base64
        }
      }
    })
  )

  const message = await anthropic.messages.create({
    model: 'claude-sonnet-4-20250514',
    max_tokens: 1024,
    messages: [{
      role: 'user',
      content: [
        {
          type: 'text',
          text: `ë‹¤ìŒì€ ìš©ì¸ì‹œ í™˜ê²½ ë¬¸ì œì— ëŒ€í•œ ì‹œë¯¼ ì œë³´ì…ë‹ˆë‹¤. ì•„ë˜ í•­ëª©ì„ ë¶„ì„í•˜ì—¬ JSONìœ¼ë¡œ ì‘ë‹µí•´ì£¼ì„¸ìš”:

1. í•µì‹¬ í‚¤ì›Œë“œ (keywords): ìµœëŒ€ 5ê°œì˜ ì£¼ìš” ë‹¨ì–´
2. ì„¸ë¶€ ìœ í˜• (detailed_type): ê°€ì¥ ì í•©í•œ ì¹´í…Œê³ ë¦¬ (chemical_smell, sewage_smell, burning_smell, illegal_waste, construction_noise, factory_noise, air_pollution, water_pollution, other)
3. ì‹¬ê°ë„ (severity): low, medium, high
4. ì¶”ì²œ ë‹´ë‹¹ ë¶€ì„œ (department): í™˜ê²½ì •ì±…ê³¼, ë§‘ì€ë¬¼ê´€ë¦¬ì‚¬ì—…ì†Œ, ì²­ì†Œí–‰ì •ê³¼ ì¤‘ í•˜ë‚˜
5. ì´ë¯¸ì§€ ë‚´ìš© (image_description): ì´ë¯¸ì§€ì—ì„œ ë°œê²¬ëœ ì£¼ìš” ë‚´ìš©

ì œë³´ ë‚´ìš©: ${description}`,
        },
        ...imageContents
      ]
    }]
  })

  const responseText = message.content[0].type === 'text'
    ? message.content[0].text
    : ''

  return JSON.parse(responseText) as ReportAnalysis
}

interface ReportAnalysis {
  keywords: string[]
  detailed_type: string
  severity: 'low' | 'medium' | 'high'
  department: string
  image_description: string
}
```

**FR 3.1.2: ë¶„ì„ ê²°ê³¼ ì €ì¥**
```sql
CREATE TABLE report_ai_analysis (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  report_id UUID REFERENCES reports(id) ON DELETE CASCADE,
  keywords TEXT[],
  detailed_type VARCHAR(50),
  severity VARCHAR(10),
  recommended_department VARCHAR(50),
  image_description TEXT,
  confidence_score DECIMAL(3, 2),  -- AI ì‹ ë¢°ë„ (0.00~1.00)
  analyzed_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

#### **User Story 3.2: íŒ¨í„´ ê°ì§€ ë° ì•Œë¦¼**

**As a** í™˜ê²½ì •ì±… ê³µë¬´ì›  
**I want to** íŠ¹ì • ì§€ì—­ì—ì„œ ìœ ì‚¬í•œ ì œë³´ê°€ ë‹¨ê¸°ê°„ì— ê¸‰ì¦í•˜ë©´ ìë™ìœ¼ë¡œ ì•Œë¦¼ì„ ë°›ì•„  
**So that** ì‹ ì†í•˜ê²Œ í˜„ì¥ ì¡°ì‚¬ë¥¼ ë‚˜ê°€ê³  ëŒ€ì‘í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ê°™ì€ ìë©´ë™ì—ì„œ ê°™ì€ ìœ í˜•ì˜ ì œë³´ê°€ 24ì‹œê°„ ë‚´ 5ê±´ ì´ìƒ ì ‘ìˆ˜ë˜ë©´ ì•Œë¦¼
- [ ] ì•Œë¦¼ì—ëŠ” ì§€ì—­, ìœ í˜•, ì œë³´ ê±´ìˆ˜, ê³µí†µ í‚¤ì›Œë“œê°€ í¬í•¨ëœë‹¤
- [ ] ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œì— 'ì´ìƒ íŒ¨í„´' ì„¹ì…˜ì´ í‘œì‹œëœë‹¤
- [ ] í•´ë‹¹ ì§€ì—­ ì‹œë¯¼ë“¤ì—ê²Œë„ ì„ íƒì ìœ¼ë¡œ ì•Œë¦¼ ë°œì†¡ ê°€ëŠ¥

**ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (FR):**

**FR 3.2.1: íŒ¨í„´ ê°ì§€ ì•Œê³ ë¦¬ì¦˜**
```typescript
// Supabase Edge Function (Cron Job: ë§¤ ì‹œê°„ ì‹¤í–‰)
async function detectAnomalies() {
  const query = `
    WITH recent_reports AS (
      SELECT 
        r.id,
        r.type,
        r.lat,
        r.lng,
        r.created_at,
        ra.keywords,
        ra.detailed_type,
        -- ìë©´ë™ êµ¬í•˜ê¸° (ì¹´ì¹´ì˜¤ API ë˜ëŠ” ì‚¬ì „ ì§€ì˜¤ì½”ë”©)
        get_dong_name(r.lat, r.lng) as dong_name
      FROM reports r
      LEFT JOIN report_ai_analysis ra ON r.id = ra.report_id
      WHERE r.created_at >= NOW() - INTERVAL '24 hours'
    ),
    anomaly_candidates AS (
      SELECT 
        dong_name,
        type,
        detailed_type,
        COUNT(*) as report_count,
        ARRAY_AGG(DISTINCT keywords) as common_keywords,
        MIN(created_at) as first_report_at,
        MAX(created_at) as last_report_at
      FROM recent_reports
      GROUP BY dong_name, type, detailed_type
      HAVING COUNT(*) >= 5  -- ì„ê³„ê°’
    )
    SELECT * FROM anomaly_candidates
  `

  const { data: anomalies } = await supabase.rpc('detect_anomalies')

  for (const anomaly of anomalies) {
    // ì´ë¯¸ ì•Œë¦¼ ë°œì†¡í–ˆëŠ”ì§€ í™•ì¸
    const { data: existing } = await supabase
      .from('anomaly_alerts')
      .select('id')
      .eq('dong_name', anomaly.dong_name)
      .eq('type', anomaly.type)
      .gte('created_at', new Date(Date.now() - 24 * 60 * 60 * 1000))
      .single()

    if (!existing) {
      await createAnomalyAlert(anomaly)
    }
  }
}

async function createAnomalyAlert(anomaly: AnomalyData) {
  // 1. DBì— ì €ì¥
  const { data: alert } = await supabase
    .from('anomaly_alerts')
    .insert({
      dong_name: anomaly.dong_name,
      type: anomaly.type,
      detailed_type: anomaly.detailed_type,
      report_count: anomaly.report_count,
      common_keywords: anomaly.common_keywords
    })
    .select()
    .single()

  // 2. ê´€ë¦¬ìì—ê²Œ í‘¸ì‹œ ì•Œë¦¼
  await notifyAdmins(alert)

  // 3. í•´ë‹¹ ì§€ì—­ ì‹œë¯¼ë“¤ì—ê²Œ ì„ íƒì  ì•Œë¦¼ (ì„¤ì •í•œ ì‚¬ìš©ìë§Œ)
  await notifyLocalResidents(alert)
}
```

---

#### **User Story 3.3: ì›”ê°„ ë™í–¥ ë¦¬í¬íŠ¸**

**As a** í™˜ê²½ í™œë™ê°€  
**I want to** ì§€ë‚œ í•œ ë‹¬ê°„ì˜ ì œë³´ ë°ì´í„°ë¥¼ ë¶„ì„í•œ AI ë¦¬í¬íŠ¸ë¥¼ ë°›ì•„  
**So that** ì •ì±… ì œì•ˆì„œì— ê°ê´€ì  ê·¼ê±°ë¡œ í™œìš©í•˜ê³  ì–¸ë¡  ë³´ë„ ìë£Œë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ë§¤ì›” 1ì¼ ìë™ìœ¼ë¡œ ì „ì›” ë¦¬í¬íŠ¸ê°€ ìƒì„±ëœë‹¤
- [ ] ë¦¬í¬íŠ¸ì—ëŠ” ë‹¤ìŒì´ í¬í•¨ëœë‹¤: ì´ ì œë³´ ê±´ìˆ˜, ì§€ì—­ë³„ ë¶„í¬, ìœ í˜•ë³„ ë¶„í¬, ì£¼ìš” í‚¤ì›Œë“œ, ì „ì›” ëŒ€ë¹„ ì¦ê°
- [ ] ê·¸ë˜í”„ì™€ íˆíŠ¸ë§µì´ í¬í•¨ëœ PDFë¡œ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•˜ë‹¤
- [ ] íŠ¹ì • ê¸°ê°„/ì§€ì—­ìœ¼ë¡œ ë§ì¶¤ ë¦¬í¬íŠ¸ ìƒì„± ê°€ëŠ¥í•˜ë‹¤

**ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (FR):**

**FR 3.3.1: ë¦¬í¬íŠ¸ ìƒì„± ë¡œì§**
```typescript
async function generateMonthlyReport(
  year: number,
  month: number
): Promise<MonthlyReport> {
  // 1. ë°ì´í„° ì§‘ê³„
  const stats = await supabase.rpc('get_monthly_stats', {
    target_year: year,
    target_month: month
  })

  // 2. Claude AIë¡œ ì¸ì‚¬ì´íŠ¸ ìƒì„±
  const insights = await anthropic.messages.create({
    model: 'claude-sonnet-4-20250514',
    max_tokens: 2048,
    messages: [{
      role: 'user',
      content: `ë‹¤ìŒì€ ìš©ì¸ì‹œ ${year}ë…„ ${month}ì›” í™˜ê²½ ì œë³´ í†µê³„ì…ë‹ˆë‹¤:

ì´ ì œë³´: ${stats.total_reports}ê±´
ì£¼ìš” ìœ í˜•: ${JSON.stringify(stats.type_distribution)}
ì§€ì—­ë³„ ë¶„í¬: ${JSON.stringify(stats.dong_distribution)}
ì£¼ìš” í‚¤ì›Œë“œ: ${stats.top_keywords.join(', ')}

ì´ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ë‹¤ìŒì„ ì‘ì„±í•´ì£¼ì„¸ìš”:
1. ì£¼ìš” í™˜ê²½ ì´ìŠˆ ìš”ì•½ (3ë¬¸ì¥)
2. ì „ì›” ëŒ€ë¹„ ë³€í™” ë¶„ì„
3. ì§€ì—­ë³„ íŠ¹ì´ì‚¬í•­
4. ì •ì±… ì œì•ˆ (3ê°€ì§€)

ë³´ê³ ì„œ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.`
    }]
  })

  const analysis = insights.content[0].type === 'text'
    ? insights.content[0].text
    : ''

  // 3. ë¦¬í¬íŠ¸ ê°ì²´ ìƒì„±
  const report: MonthlyReport = {
    period: `${year}-${month.toString().padStart(2, '0')}`,
    stats,
    analysis,
    charts: {
      typeDistribution: generateChartData(stats.type_distribution),
      dongDistribution: generateChartData(stats.dong_distribution),
      timeline: generateTimelineData(stats.daily_counts)
    },
    generatedAt: new Date()
  }

  // 4. DBì— ì €ì¥
  await supabase.from('monthly_reports').insert({
    period: report.period,
    data: report,
    generated_at: report.generatedAt
  })

  return report
}
```

**FR 3.3.2: PDF ìƒì„±**
```typescript
import { jsPDF } from 'jspdf'
import html2canvas from 'html2canvas'

async function exportReportToPDF(report: MonthlyReport): Promise<Blob> {
  const pdf = new jsPDF('p', 'mm', 'a4')

  // 1. í‘œì§€
  pdf.setFontSize(24)
  pdf.text('ìš©ì¸ ê·¸ë¦°ì›Œì¹˜ ì›”ê°„ ë¦¬í¬íŠ¸', 105, 50, { align: 'center' })
  pdf.setFontSize(16)
  pdf.text(report.period, 105, 65, { align: 'center' })

  // 2. í†µê³„ ì„¹ì…˜
  pdf.addPage()
  pdf.setFontSize(18)
  pdf.text('í™˜ê²½ ì œë³´ í†µê³„', 20, 20)
  pdf.setFontSize(12)
  pdf.text(`ì´ ì œë³´: ${report.stats.total_reports}ê±´`, 20, 35)

  // 3. ì°¨íŠ¸ ì‚½ì… (canvasë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜)
  const chartCanvas = await html2canvas(document.getElementById('type-chart'))
  const chartImage = chartCanvas.toDataURL('image/png')
  pdf.addImage(chartImage, 'PNG', 20, 50, 170, 100)

  // 4. AI ë¶„ì„ ì„¹ì…˜
  pdf.addPage()
  pdf.setFontSize(18)
  pdf.text('AI ë¶„ì„ ë¦¬í¬íŠ¸', 20, 20)
  pdf.setFontSize(11)
  const analysisLines = pdf.splitTextToSize(report.analysis, 170)
  pdf.text(analysisLines, 20, 35)

  return pdf.output('blob')
}
```

---

### **Epic 4: ë…¹ìƒ‰ ë³´ìƒ ë§ˆì¼“í”Œë ˆì´ìŠ¤ (Green Rewards Marketplace)**

**Epic Goal**: í™˜ê²½ ê°œì„  í™œë™ì— ì°¸ì—¬í•œ ì‹œë¯¼ë“¤ì—ê²Œ ë³´ìƒì„ ì œê³µí•˜ê³ , ì¹œí™˜ê²½ ì†Œë¹„ ìƒíƒœê³„ë¥¼ ì¡°ì„±í•œë‹¤.

#### **User Story 4.1: í¬ì¸íŠ¸ ì ë¦½**

**As a** ì¼ë°˜ ì‹œë¯¼  
**I want to** ì œë³´, ê³µê°, ì¹œí™˜ê²½ ì±Œë¦°ì§€ ì°¸ì—¬ ë“± í™œë™ì„ í•  ë•Œë§ˆë‹¤ í¬ì¸íŠ¸ë¥¼ ë°›ì•„  
**So that** ëª¨ì€ í¬ì¸íŠ¸ë¡œ ì¹œí™˜ê²½ ìƒì ì—ì„œ í˜œíƒì„ ë°›ê³  í™˜ê²½ ê°œì„ ì— ì§€ì†ì ìœ¼ë¡œ ì°¸ì—¬í•  ë™ê¸°ë¥¼ ê°–ëŠ”ë‹¤

**Acceptance Criteria:**
- [ ] íšŒì›ê°€ì… ì‹œ 100P ì§€ê¸‰
- [ ] ì œë³´ ì‹œ 50P, ê³µê° 5íšŒ ì´ìƒ ë°›ìœ¼ë©´ ì¶”ê°€ 50P
- [ ] ë‹¤ë¥¸ ì œë³´ì— ê³µê° ì‹œ 5P (1ì¼ ìµœëŒ€ 5íšŒ)
- [ ] ì›” 1íšŒ ì´ìƒ í™œë™ ì‹œ ì¶©ì„±ë„ ë³´ë„ˆìŠ¤ 30P
- [ ] í¬ì¸íŠ¸ ë‚´ì—­ì„ 'ë‚´ í¬ì¸íŠ¸' íƒ­ì—ì„œ í™•ì¸ ê°€ëŠ¥

**ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (FR):**

**FR 4.1.1: í¬ì¸íŠ¸ ì‹œìŠ¤í…œ ìŠ¤í‚¤ë§ˆ**
```sql
CREATE TABLE user_points (
  user_id UUID PRIMARY KEY REFERENCES auth.users(id),
  total_points INTEGER DEFAULT 0,
  available_points INTEGER DEFAULT 0,
  used_points INTEGER DEFAULT 0,
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE point_transactions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  type VARCHAR(30) NOT NULL CHECK (type IN (
    'signup_bonus',
    'report_submitted',
    'report_empathized',
    'empathy_given',
    'monthly_bonus',
    'challenge_completed',
    'point_used',
    'point_refund'
  )),
  amount INTEGER NOT NULL,
  balance_after INTEGER NOT NULL,
  reference_id UUID,  -- ê´€ë ¨ ì œë³´ ID, ì±Œë¦°ì§€ ID ë“±
  description TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_point_tx_user ON point_transactions(user_id, created_at DESC);
```

**FR 4.1.2: í¬ì¸íŠ¸ ì§€ê¸‰ ë¡œì§**
```typescript
type PointEventType =
  | 'signup_bonus'
  | 'report_submitted'
  | 'report_empathized'
  | 'empathy_given'
  | 'monthly_bonus'
  | 'challenge_completed'

const POINT_RULES: Record<PointEventType, number> = {
  signup_bonus: 100,
  report_submitted: 50,
  report_empathized: 50,  // ê³µê° 5íšŒ ì´ìƒ ì‹œ
  empathy_given: 5,       // 1ì¼ ìµœëŒ€ 5íšŒ
  monthly_bonus: 30,      // ì›” 1íšŒ ì´ìƒ í™œë™ ì‹œ
  challenge_completed: 100 // ì±Œë¦°ì§€ë³„ ìƒì´
}

async function addPoints(
  userId: string,
  type: PointEventType,
  amount: number,
  referenceId?: string,
  description?: string
) {
  return await supabase.rpc('add_user_points', {
    p_user_id: userId,
    p_type: type,
    p_amount: amount,
    p_reference_id: referenceId,
    p_description: description
  })
}

// PostgreSQL í•¨ìˆ˜
CREATE OR REPLACE FUNCTION add_user_points(
  p_user_id UUID,
  p_type VARCHAR,
  p_amount INTEGER,
  p_reference_id UUID DEFAULT NULL,
  p_description TEXT DEFAULT NULL
)
RETURNS void AS $$
DECLARE
  v_new_balance INTEGER;
BEGIN
  -- 1. user_points ì—…ë°ì´íŠ¸
  UPDATE user_points
  SET 
    total_points = total_points + p_amount,
    available_points = available_points + p_amount,
    updated_at = NOW()
  WHERE user_id = p_user_id
  RETURNING available_points INTO v_new_balance;

  -- 2. íŠ¸ëœì­ì…˜ ê¸°ë¡
  INSERT INTO point_transactions (
    user_id, type, amount, balance_after, reference_id, description
  ) VALUES (
    p_user_id, p_type, p_amount, v_new_balance, p_reference_id, p_description
  );
END;
$$ LANGUAGE plpgsql;
```

**FR 4.1.3: ì¼ì¼ ì œí•œ ë¡œì§**
```typescript
// ê³µê° í¬ì¸íŠ¸ëŠ” 1ì¼ ìµœëŒ€ 5íšŒ
async function giveEmpathy(userId: string, reportId: string) {
  // 1. ì˜¤ëŠ˜ ê³µê° íšŸìˆ˜ í™•ì¸
  const { data: todayEmpathy } = await supabase
    .from('point_transactions')
    .select('id')
    .eq('user_id', userId)
    .eq('type', 'empathy_given')
    .gte('created_at', new Date().setHours(0, 0, 0, 0))

  if (todayEmpathy && todayEmpathy.length >= 5) {
    throw new Error('ì˜¤ëŠ˜ì˜ ê³µê° í¬ì¸íŠ¸ ì ë¦½ í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤')
  }

  // 2. ê³µê° ì²˜ë¦¬
  await supabase.from('report_empathy').insert({
    report_id: reportId,
    user_id: userId
  })

  // 3. í¬ì¸íŠ¸ ì§€ê¸‰
  await addPoints(
    userId,
    'empathy_given',
    5,
    reportId,
    'ì œë³´ ê³µê° ì°¸ì—¬'
  )
}
```

---

#### **User Story 4.2: íŒŒíŠ¸ë„ˆ ìƒì  ê²€ìƒ‰**

**As a** ì¹œí™˜ê²½ ì†Œë¹„ì— ê´€ì‹¬ ìˆëŠ” ì‹œë¯¼  
**I want to** ë‚´ ìœ„ì¹˜ ê·¼ì²˜ì˜ ì œë¡œì›¨ì´ìŠ¤íŠ¸ìƒµ, ì¹œí™˜ê²½ ì‹ë‹¹ ë“±ì„ ì§€ë„ì—ì„œ ì°¾ê³   
**So that** ëª¨ì€ í¬ì¸íŠ¸ë¡œ í• ì¸ ë°›ìœ¼ë©° ì¹œí™˜ê²½ ì†Œë¹„ë¥¼ ì‹¤ì²œí•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] 'ë§ˆì¼“í”Œë ˆì´ìŠ¤' íƒ­ì—ì„œ íŒŒíŠ¸ë„ˆ ìƒì  ëª©ë¡ê³¼ ì§€ë„ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤
- [ ] ìƒì ì€ ì¹´í…Œê³ ë¦¬ë³„(ì œë¡œì›¨ì´ìŠ¤íŠ¸/ë¡œì»¬í‘¸ë“œ/ì¹œí™˜ê²½ì‹ë‹¹/ì¤‘ê³ ê±°ë˜) í•„í„°ë§ ê°€ëŠ¥
- [ ] ê° ìƒì ì˜ í˜œíƒ ë‚´ìš©(ì˜ˆ: 1000P â†’ 10% í• ì¸)ì´ í‘œì‹œëœë‹¤
- [ ] ìƒì  ìƒì„¸ í˜ì´ì§€ì—ì„œ ìœ„ì¹˜, ì˜ì—…ì‹œê°„, í˜œíƒ ì‚¬ìš©ë²•ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

**ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (FR):**

**FR 4.2.1: íŒŒíŠ¸ë„ˆ ìƒì  ìŠ¤í‚¤ë§ˆ**
```sql
CREATE TABLE partner_stores (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  name VARCHAR(100) NOT NULL,
  category VARCHAR(50) CHECK (category IN (
    'zero_waste', 'local_food', 'eco_restaurant', 
    'secondhand', 'eco_cafe', 'other'
  )),
  address VARCHAR(200),
  lat DECIMAL(10, 7),
  lng DECIMAL(10, 7),
  phone VARCHAR(20),
  business_hours JSONB,  -- { "mon": "10:00-20:00", ... }
  description TEXT,
  logo_url TEXT,
  status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'inactive')),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE store_benefits (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  store_id UUID REFERENCES partner_stores(id) ON DELETE CASCADE,
  title VARCHAR(100),
  description TEXT,
  point_cost INTEGER NOT NULL,  -- í•„ìš” í¬ì¸íŠ¸
  discount_type VARCHAR(20) CHECK (discount_type IN ('percent', 'fixed')),
  discount_value DECIMAL(10, 2),  -- í• ì¸ìœ¨(%) ë˜ëŠ” í• ì¸ì•¡(ì›)
  max_usage_per_user INTEGER DEFAULT 1,  -- ì‚¬ìš©ìë‹¹ ì›” ì‚¬ìš© ì œí•œ
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_stores_location ON partner_stores(lat, lng);
CREATE INDEX idx_stores_category ON partner_stores(category);
```

**FR 4.2.2: ì§€ë„ ë° ë¦¬ìŠ¤íŠ¸ UI**
```typescript
interface PartnerStore {
  id: string
  name: string
  category: StoreCategory
  address: string
  lat: number
  lng: number
  phone: string
  businessHours: BusinessHours
  description: string
  logoUrl?: string
  benefits: StoreBenefit[]
  distance?: number  // ì‚¬ìš©ì ìœ„ì¹˜ë¡œë¶€í„° ê±°ë¦¬(km)
}

interface StoreBenefit {
  id: string
  title: string
  description: string
  pointCost: number
  discountType: 'percent' | 'fixed'
  discountValue: number
}

// ê±°ë¦¬ ê³„ì‚° (Haversine formula)
function calculateDistance(
  lat1: number,
  lng1: number,
  lat2: number,
  lng2: number
): number {
  const R = 6371 // ì§€êµ¬ ë°˜ê²½ (km)
  const dLat = toRad(lat2 - lat1)
  const dLng = toRad(lng2 - lng1)
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(toRad(lat1)) *
      Math.cos(toRad(lat2)) *
      Math.sin(dLng / 2) *
      Math.sin(dLng / 2)
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))
  return R * c
}
```

---

#### **User Story 4.3: í˜œíƒ ì‚¬ìš© (QRì½”ë“œ)**

**As a** ì‹œë¯¼  
**I want to** íŒŒíŠ¸ë„ˆ ìƒì ì—ì„œ ì•±ì˜ QRì½”ë“œë¥¼ ë³´ì—¬ì£¼ê³  í¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•´  
**So that** ì¹œí™˜ê²½ ì œí’ˆì„ í• ì¸ëœ ê°€ê²©ì— êµ¬ë§¤í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ìƒì  ìƒì„¸ í˜ì´ì§€ì—ì„œ 'í˜œíƒ ì‚¬ìš©' ë²„íŠ¼ í´ë¦­
- [ ] ì¼íšŒìš© QRì½”ë“œ(60ì´ˆ ìœ íš¨)ê°€ ìƒì„±ëœë‹¤
- [ ] ì ì£¼ëŠ” íŒŒíŠ¸ë„ˆ ì•±ìœ¼ë¡œ QRì½”ë“œë¥¼ ìŠ¤ìº”í•œë‹¤
- [ ] ìŠ¤ìº” ì„±ê³µ ì‹œ í¬ì¸íŠ¸ê°€ ì°¨ê°ë˜ê³  ì˜ìˆ˜ì¦ ë²ˆí˜¸ê°€ í‘œì‹œëœë‹¤
- [ ] ì‚¬ìš© ë‚´ì—­ì´ 'ë‚´ í¬ì¸íŠ¸' íƒ­ì— ê¸°ë¡ëœë‹¤

**ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (FR):**

**FR 4.3.1: QRì½”ë“œ ìƒì„±**
```typescript
import QRCode from 'qrcode'
import { nanoid } from 'nanoid'

async function generateBenefitQR(
  userId: string,
  benefitId: string,
  storeId: string
): Promise<BenefitQRData> {
  // 1. í¬ì¸íŠ¸ ì¶©ë¶„í•œì§€ í™•ì¸
  const benefit = await getBenefit(benefitId)
  const userPoints = await getUserPoints(userId)
  
  if (userPoints.available_points < benefit.point_cost) {
    throw new Error('í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤')
  }

  // 2. ì¼íšŒìš© í† í° ìƒì„±
  const token = nanoid(32)
  const expiresAt = new Date(Date.now() + 60 * 1000) // 60ì´ˆ í›„

  // 3. DBì— ì €ì¥
  const { data: qrData } = await supabase
    .from('benefit_qr_tokens')
    .insert({
      token,
      user_id: userId,
      benefit_id: benefitId,
      store_id: storeId,
      expires_at: expiresAt,
      status: 'pending'
    })
    .select()
    .single()

  // 4. QRì½”ë“œ ìƒì„±
  const qrCodeUrl = await QRCode.toDataURL(token)

  return {
    token,
    qrCodeUrl,
    benefit,
    expiresAt
  }
}
```

**FR 4.3.2: QRì½”ë“œ ìŠ¤ìº” (ì ì£¼ìš©)**
```typescript
// íŒŒíŠ¸ë„ˆ ì•± ë˜ëŠ” ì›¹ í¬í„¸
async function scanBenefitQR(
  token: string,
  storeId: string,
  partnerId: string
): Promise<BenefitUsageResult> {
  // 1. í† í° ì¡°íšŒ
  const { data: qrData } = await supabase
    .from('benefit_qr_tokens')
    .select('*, benefits(*)')
    .eq('token', token)
    .eq('store_id', storeId)
    .eq('status', 'pending')
    .single()

  if (!qrData) {
    throw new Error('ìœ íš¨í•˜ì§€ ì•Šì€ QRì½”ë“œì…ë‹ˆë‹¤')
  }

  // 2. ë§Œë£Œ í™•ì¸
  if (new Date() > new Date(qrData.expires_at)) {
    throw new Error('QRì½”ë“œê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤')
  }

  // 3. í¬ì¸íŠ¸ ì°¨ê°
  const receiptNo = `YGW-${Date.now()}`
  
  await supabase.rpc('use_benefit_points', {
    p_user_id: qrData.user_id,
    p_benefit_id: qrData.benefit_id,
    p_token: token,
    p_receipt_no: receiptNo,
    p_partner_id: partnerId
  })

  return {
    success: true,
    receiptNo,
    benefit: qrData.benefits,
    userId: qrData.user_id
  }
}

// PostgreSQL í•¨ìˆ˜
CREATE OR REPLACE FUNCTION use_benefit_points(
  p_user_id UUID,
  p_benefit_id UUID,
  p_token VARCHAR,
  p_receipt_no VARCHAR,
  p_partner_id UUID
)
RETURNS void AS $$
DECLARE
  v_point_cost INTEGER;
  v_new_balance INTEGER;
BEGIN
  -- 1. í˜œíƒ ì •ë³´ ì¡°íšŒ
  SELECT point_cost INTO v_point_cost
  FROM store_benefits
  WHERE id = p_benefit_id;

  -- 2. í¬ì¸íŠ¸ ì°¨ê°
  UPDATE user_points
  SET 
    available_points = available_points - v_point_cost,
    used_points = used_points + v_point_cost,
    updated_at = NOW()
  WHERE user_id = p_user_id
  RETURNING available_points INTO v_new_balance;

  -- 3. íŠ¸ëœì­ì…˜ ê¸°ë¡
  INSERT INTO point_transactions (
    user_id, type, amount, balance_after, reference_id, description
  ) VALUES (
    p_user_id, 'point_used', -v_point_cost, v_new_balance, p_benefit_id, p_receipt_no
  );

  -- 4. ì‚¬ìš© ê¸°ë¡
  INSERT INTO benefit_usage_history (
    user_id, benefit_id, token, receipt_no, used_by, used_at
  ) VALUES (
    p_user_id, p_benefit_id, p_token, p_receipt_no, p_partner_id, NOW()
  );

  -- 5. QR í† í° ìƒíƒœ ë³€ê²½
  UPDATE benefit_qr_tokens
  SET status = 'used', used_at = NOW()
  WHERE token = p_token;
END;
$$ LANGUAGE plpgsql;
```

---

### **Epic 5: ì•Œë¦¼ ë° ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ (Notifications & Communication)**

#### **User Story 5.1: ë§ì¶¤í˜• í™˜ê²½ ì•Œë¦¼**

**As a** í˜¸í¡ê¸° ì§ˆí™˜ì  
**I want to** ìš°ë¦¬ ë™ë„¤ ë¯¸ì„¸ë¨¼ì§€ê°€ 'ë‚˜ì¨' ë‹¨ê³„ì— ë“¤ì–´ê°€ë©´ ì¦‰ì‹œ ì•Œë¦¼ì„ ë°›ì•„  
**So that** ì™¸ì¶œì„ ìì œí•˜ê³  ê±´ê°•ì„ ì§€í‚¬ ìˆ˜ ìˆë‹¤

**ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ (FR):**

**FR 5.1.1: ì•Œë¦¼ ì„¤ì •**
```typescript
interface NotificationSettings {
  userId: string
  airQualityAlert: {
    enabled: boolean
    threshold: 'bad' | 'very_bad'  // 'ë‚˜ì¨' ë˜ëŠ” 'ë§¤ìš°ë‚˜ì¨'ë¶€í„°
    locations: string[]  // ê´€ì‹¬ ì§€ì—­ (ìë©´ë™)
  }
  reportStatusUpdate: boolean
  anomalyAlert: boolean  // ì´ìƒ íŒ¨í„´ ê°ì§€ ì•Œë¦¼
  monthlyReport: boolean
  marketingConsent: boolean
}
```

**FR 5.1.2: í‘¸ì‹œ ì•Œë¦¼ ì‹œìŠ¤í…œ**
```typescript
// Firebase Cloud Messaging
import admin from 'firebase-admin'

async function sendAirQualityAlert(
  userId: string,
  location: string,
  pm25Value: number,
  grade: number
) {
  const { data: user } = await supabase
    .from('users')
    .select('fcm_token')
    .eq('id', userId)
    .single()

  if (!user?.fcm_token) return

  const message = {
    token: user.fcm_token,
    notification: {
      title: `${location} ë¯¸ì„¸ë¨¼ì§€ ë‚˜ì¨`,
      body: `í˜„ì¬ PM2.5 ë†ë„ ${pm25Value}ã/ã¥ ì…ë‹ˆë‹¤. ì™¸ì¶œ ì‹œ ë§ˆìŠ¤í¬ë¥¼ ì°©ìš©í•˜ì„¸ìš”.`,
      imageUrl: 'https://yongin-greenwatch.app/images/air-alert.png'
    },
    data: {
      type: 'air_quality_alert',
      location,
      pm25Value: pm25Value.toString(),
      grade: grade.toString()
    }
  }

  await admin.messaging().send(message)
}
```

---

## **3. ê¸°ìˆ  ëª…ì„¸ (Technical Specifications)**

### **3.1. ê¸°ìˆ  ìŠ¤íƒ**

| êµ¬ë¶„ | ê¸°ìˆ  | ë²„ì „ | ì‚¬ìœ  |
|------|------|------|------|
| **í”„ë¡ íŠ¸ì—”ë“œ** | Next.js | 14.x (App Router) | SSR/SSG ì§€ì›, ìµœì í™”ëœ ì„±ëŠ¥, Vercel ë°°í¬ ê°„í¸ |
| | TypeScript | 5.x | íƒ€ì… ì•ˆì •ì„±, ê°œë°œ ìƒì‚°ì„± í–¥ìƒ |
| | Tailwind CSS | 3.x | ë¹ ë¥¸ UI ê°œë°œ, ì¼ê´€ëœ ë””ìì¸ ì‹œìŠ¤í…œ |
| | shadcn/ui | Latest | ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ê³ í’ˆì§ˆ ì»´í¬ë„ŒíŠ¸ |
| **ìƒíƒœ ê´€ë¦¬** | Zustand | 4.x | ê°€ë²¼ìš´ ì „ì—­ ìƒíƒœ ê´€ë¦¬ |
| | React Query | 5.x | ì„œë²„ ìƒíƒœ ìºì‹± ë° ë™ê¸°í™” |
| **ì§€ë„** | Kakao Map SDK | 2.x | êµ­ë‚´ ìµœì í™”, ë¬´ë£Œ í• ë‹¹ëŸ‰ ì¶©ë¶„ |
| **ë°±ì—”ë“œ** | Supabase | Latest | PostgreSQL, Auth, Storage, Realtime í†µí•© |
| **ë°ì´í„°ë² ì´ìŠ¤** | PostgreSQL | 15.x | Supabase ê¸°ë³¸ ì œê³µ |
| **ì¸ì¦** | Supabase Auth | - | ì´ë©”ì¼, ì†Œì…œ ë¡œê·¸ì¸ ì§€ì› |
| **ìŠ¤í† ë¦¬ì§€** | Supabase Storage | - | ì´ë¯¸ì§€/ë™ì˜ìƒ ì €ì¥ |
| **AI** | Claude API | Sonnet 4 | í…ìŠ¤íŠ¸/ì´ë¯¸ì§€ ë¶„ì„, ë¦¬í¬íŠ¸ ìƒì„± |
| **í‘¸ì‹œ ì•Œë¦¼** | Firebase CM | Latest | í¬ë¡œìŠ¤ í”Œë«í¼ í‘¸ì‹œ ì•Œë¦¼ |
| **ì°¨íŠ¸** | Recharts | 2.x | ë°˜ì‘í˜• ì°¨íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ |
| **QRì½”ë“œ** | qrcode | 1.x | QR ìƒì„±, ê²½ëŸ‰ ë¼ì´ë¸ŒëŸ¬ë¦¬ |
| **ë°°í¬** | Vercel | - | ìë™ CI/CD, ê¸€ë¡œë²Œ CDN |

### **3.2. ì•„í‚¤í…ì²˜**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ì‚¬ìš©ì ë””ë°”ì´ìŠ¤                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   iOS App    â”‚  â”‚  Android App â”‚  â”‚  Web Browser â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTPS
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Vercel (CDN + Edge)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          Next.js 14 (App Router)                 â”‚  â”‚
â”‚  â”‚  - SSR/SSG Pages                                 â”‚  â”‚
â”‚  â”‚  - API Routes (/api/*)                           â”‚  â”‚
â”‚  â”‚  - Server Actions                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚        â”‚        â”‚        â”‚           â”‚
     â–¼        â–¼        â–¼        â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Supabase â”‚ â”‚  Kakao     â”‚ â”‚Air Korea â”‚ â”‚Claude  â”‚ â”‚Firebase  â”‚
â”‚         â”‚ â”‚  Map API   â”‚ â”‚   API    â”‚ â”‚  API   â”‚ â”‚   FCM    â”‚
â”‚-Auth    â”‚ â”‚            â”‚ â”‚          â”‚ â”‚        â”‚ â”‚          â”‚
â”‚-Databaseâ”‚ â”‚            â”‚ â”‚          â”‚ â”‚        â”‚ â”‚          â”‚
â”‚-Storage â”‚ â”‚            â”‚ â”‚          â”‚ â”‚        â”‚ â”‚          â”‚
â”‚-Realtimeâ”‚ â”‚            â”‚ â”‚          â”‚ â”‚        â”‚ â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **3.3. ë°ì´í„°ë² ì´ìŠ¤ ERD (í•µì‹¬ í…Œì´ë¸”)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users     â”‚       â”‚   reports    â”‚       â”‚report_media  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)      â”‚â—„â”€â”€â”€â”€â”€â”¤â”‚ id (PK)      â”‚â—„â”€â”€â”€â”€â”€â”¤â”‚ id (PK)      â”‚
â”‚ email        â”‚       â”‚ user_id (FK) â”‚       â”‚ report_id(FK)â”‚
â”‚ name         â”‚       â”‚ type         â”‚       â”‚ media_url    â”‚
â”‚ phone        â”‚       â”‚ description  â”‚       â”‚ media_type   â”‚
â”‚ created_at   â”‚       â”‚ lat          â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ lng          â”‚
                       â”‚ address      â”‚
                       â”‚ status       â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ empathy_countâ”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚report_empathyâ”‚
                       â”‚ created_at   â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ id (PK)      â”‚
                              â”‚               â”‚ report_id(FK)â”‚
                              â”‚               â”‚ user_id (FK) â”‚
                              â–¼               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚report_ai_    â”‚
                       â”‚  analysis    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚user_points   â”‚
                       â”‚ id (PK)      â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                       â”‚ report_id(FK)â”‚â—„â”€â”€â”€â”€â”€â”¤â”‚ user_id (PK) â”‚
                       â”‚ keywords[]   â”‚       â”‚ total_points â”‚
                       â”‚ detailed_typeâ”‚       â”‚ available_ptsâ”‚
                       â”‚ severity     â”‚       â”‚ used_points  â”‚
                       â”‚ department   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â–¼
â”‚partner_storesâ”‚â—„â”€â”€â”€â”€â”€â”¤â”‚store_benefitsâ”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚point_        â”‚
â”‚ id (PK)      â”‚       â”‚ id (PK)      â”‚       â”‚ transactions â”‚
â”‚ name         â”‚       â”‚ store_id (FK)â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ category     â”‚       â”‚ title        â”‚       â”‚ id (PK)      â”‚
â”‚ lat          â”‚       â”‚ point_cost   â”‚       â”‚ user_id (FK) â”‚
â”‚ lng          â”‚       â”‚ discount_typeâ”‚       â”‚ type         â”‚
â”‚ address      â”‚       â”‚ discount_val â”‚       â”‚ amount       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ balance_afterâ”‚
                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **3.4. API ì„¤ê³„**

#### **ê³µê³µ ë°ì´í„° API**

**ì—ì–´ì½”ë¦¬ì•„ ëŒ€ê¸°ì§ˆ API**
```typescript
// ì¸¡ì •ì†Œë³„ ì‹¤ì‹œê°„ ëŒ€ê¸°ì§ˆ ì •ë³´
GET https://apis.data.go.kr/B552584/ArpltnInforInqireSvc/getMsrstnAcctoRltmMesureDnsty
Parameters:
  - serviceKey: ê³µê³µë°ì´í„°í¬í„¸ ì¸ì¦í‚¤
  - stationName: ì¸¡ì •ì†Œëª… (ì˜ˆ: "ìˆ˜ì§€")
  - dataTerm: "DAILY" | "MONTH" | "3MONTH"
  - ver: "1.3"

Response:
{
  "response": {
    "body": {
      "items": [{
        "stationName": "ìˆ˜ì§€",
        "dataTime": "2025-10-03 14:00",
        "pm10Value": "45",
        "pm25Value": "23",
        "o3Value": "0.045",
        "no2Value": "0.032",
        "pm10Grade": "2",
        "pm25Grade": "1"
      }]
    }
  }
}
```

#### **Supabase Edge Functions**

```typescript
// 1. ì œë³´ ì œì¶œ
POST /functions/v1/submit-report
Body: {
  type: string
  description: string
  lat: number
  lng: number
  address: string
  mediaFiles: File[]
  isAnonymous: boolean
}
Response: { reportId: string, status: 'success' }

// 2. AI ë¶„ì„ íŠ¸ë¦¬ê±°
POST /functions/v1/analyze-report
Body: { reportId: string }
Response: { analysis: ReportAnalysis }

// 3. ì›”ê°„ ë¦¬í¬íŠ¸ ìƒì„±
POST /functions/v1/generate-monthly-report
Body: { year: number, month: number }
Response: { reportId: string, downloadUrl: string }

// 4. QR ì½”ë“œ ìƒì„±
POST /functions/v1/generate-benefit-qr
Body: { benefitId: string, storeId: string }
Response: { token: string, qrCodeUrl: string, expiresAt: Date }
```

---

## **4. ë¦´ë¦¬ì¦ˆ ê³„íš (Release Plan)**

### **Phase 1: MVP (0~6ê°œì›”)**

**ëª©í‘œ**: í•µì‹¬ ê°€ì¹˜ ê²€ì¦ - "ì‹œë¯¼ë“¤ì´ í™˜ê²½ ë°ì´í„°ë¥¼ í™•ì¸í•˜ê³  ì œë³´í•˜ëŠ” ê²ƒ"

**ê°œë°œ ì¼ì •**:
- ì›” 1~2: ê¸°íš í™•ì •, ë””ìì¸ ì‹œìŠ¤í…œ, í”„ë¡œì íŠ¸ ì…‹ì—…
- ì›” 3~4: ì‹¤ì‹œê°„ í™˜ê²½ ì§€ë„ ê°œë°œ (Epic 1)
- ì›” 4~5: ì‹œë¯¼ ì œë³´ ì‹œìŠ¤í…œ ê°œë°œ (Epic 2)
- ì›” 5~6: í†µí•© í…ŒìŠ¤íŠ¸, ë² íƒ€ í…ŒìŠ¤íŠ¸, ì •ì‹ ì¶œì‹œ

**ì£¼ìš” ê¸°ëŠ¥**:
- âœ… ì‹¤ì‹œê°„ ëŒ€ê¸°ì§ˆ ì§€ë„ (5ì¢… ì˜¤ì—¼ë¬¼ì§ˆ)
- âœ… ì‹œë¯¼ ì œë³´ (ì‚¬ì§„, ìœ„ì¹˜, ìœ í˜• ì„ íƒ)
- âœ… ì œë³´ í”¼ë“œ ë° ê³µê° ê¸°ëŠ¥
- âœ… ë‚´ ì œë³´ í˜„í™© í™•ì¸
- âœ… ê¸°ë³¸ íšŒì›ê°€ì… ë° ë¡œê·¸ì¸
- âœ… ê´€ë¦¬ì ì œë³´ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

**ì„±ê³µ ì§€í‘œ**:
- ì•± ë‹¤ìš´ë¡œë“œ 5,000ê±´
- MAU 2,000ëª…
- ëˆ„ì  ì œë³´ 500ê±´

---

### **Phase 2: V1.0 - AI ë° ì•Œë¦¼ (7~12ê°œì›”)**

**ëª©í‘œ**: AI ë¶„ì„ìœ¼ë¡œ ì¸ì‚¬ì´íŠ¸ ì œê³µ, ì•Œë¦¼ìœ¼ë¡œ ì‚¬ìš©ì ì¬ë°©ë¬¸ ìœ ë„

**ì£¼ìš” ê¸°ëŠ¥**:
- âœ… Claude AI ìë™ íƒœê¹… ë° ë¶„ë¥˜ (Epic 3.1)
- âœ… ì´ìƒ íŒ¨í„´ ê°ì§€ ë° ì•Œë¦¼ (Epic 3.2)
- âœ… ë§ì¶¤í˜• í™˜ê²½ ì•Œë¦¼ (Epic 5.1)
- âœ… ì‹œê°„ëŒ€ë³„ ë°ì´í„° ì¡°íšŒ ë° ì°¨íŠ¸
- âœ… íˆíŠ¸ë§µ ë·°
- âœ… ì£¼ìš” ì‹œì„¤ ì •ë³´ í‘œì‹œ

**ì„±ê³µ ì§€í‘œ**:
- MAU 10,000ëª…
- ì›” í‰ê·  ì œë³´ 300ê±´
- í‘¸ì‹œ ì•Œë¦¼ ì˜¤í”ˆìœ¨ 30% ì´ìƒ

---

### **Phase 3: V1.5 - ìƒíƒœê³„ í™•ì¥ (13~24ê°œì›”)**

**ëª©í‘œ**: ë…¹ìƒ‰ ë³´ìƒìœ¼ë¡œ ì§€ì† ê°€ëŠ¥í•œ ì°¸ì—¬ ìƒíƒœê³„ êµ¬ì¶•

**ì£¼ìš” ê¸°ëŠ¥**:
- âœ… í¬ì¸íŠ¸ ì‹œìŠ¤í…œ (Epic 4.1)
- âœ… íŒŒíŠ¸ë„ˆ ìƒì  ë§ˆì¼“í”Œë ˆì´ìŠ¤ (Epic 4.2)
- âœ… QRì½”ë“œ í˜œíƒ ì‚¬ìš© (Epic 4.3)
- âœ… ì›”ê°„ AI ë¦¬í¬íŠ¸ ìë™ ìƒì„± (Epic 3.3)
- âœ… ì¹œí™˜ê²½ ì±Œë¦°ì§€
- âœ… í™˜ê²½ êµìœ¡ ì½˜í…ì¸ 

**ì„±ê³µ ì§€í‘œ**:
- MAU 50,000ëª… (ì‹œë¯¼ì˜ 5%)
- íŒŒíŠ¸ë„ˆ ìƒì  50ê°œ
- ì›”ê°„ í¬ì¸íŠ¸ ì‚¬ìš©ë¥  25%
- ì •ì±… ë°˜ì˜ ì—° 10ê±´

---

## **5. User Journey (ì‚¬ìš©ì ì—¬ì •)**

ê³„ì†í•´ì„œ ìƒì„¸í•œ User Journeyë¥¼ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤. ë‹¤ìŒ ë©”ì‹œì§€ì—ì„œ ê³„ì† ì´ì–´ê°€ê² ìŠµë‹ˆë‹¤!